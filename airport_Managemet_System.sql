CREATE TABLE AIRPORT
(AIRPORT_NAME VARCHAR(20) NOT NULL,
CITY VARCHAR(20),
STATE VARCHAR(20),
PRIMARY KEY (AIRPORT_NAME));
DESC AIRPORT;

INSERT INTO AIRPORT VALUES ('SHIVAJI', 'MUMBAI','MAHARASHTRA');
INSERT INTO AIRPORT VALUES ('INDIRA GANDHI','DELHI','DELHI');
SELECT * FROM AIRPORT;

CREATE TABLE AIRLINE
(AIRLINE_ID INT NOT NULL PRIMARY KEY,
AIRLINE_NAME VARCHAR(10),
AIRPORT_NAME VARCHAR(20),
FOREIGN KEY (AIrPORT_NAME) REFERENCES AIRPORT(AIRPORT_NAME));
DESC AIRLINE;

INSERT INTO AIRLINE VALUES(123,'MLINES','SHIVAJI');
INSERT INTO AIRLINE VALUES(124,'DLINES','INDIRA GANDHI');

SELECT * FROM AIRLINE;

CREATE OR REPLACE PROCEDURE DISPLAY_AIRLINES_OF_AIRPORT(AN VARCHAR)
IS
TEMP AIRLINE%ROWTYPE;
BEGIN
SELECT * INTO TEMP FROM AIRLINE WHERE AIRPORT_NAME=AN;
DBMS_OUTPUT.PUT_LINE('AIRPORT_NAME: '||TEMP.AIRPORT_NAME||' AIRLINE ID: '||TEMP.AIRLINE_ID||' AIRLINE_NAME: '||TEMP.AIRLINE_NAME);
END;
BEGIN
DISPLAY_AIRLINES_OF_AIRPORT('SHIVAJI');
END;

CREATE TABLE CONTAINS
(AIRPORT_NAME VARCHAR(20),
AIRLINE_ID INT,
FOREIGN KEY (AIRPORT_NAME) REFERENCES AIRPORT(AIRPORT_NAME),
FOREIGN KEY (AIRLINE_ID) REFERENCES AIRLINE(AIRLINE_ID));
DESC CONTAINS;
INSERT INTO CONTAINS VALUES('SHIVAJI',123);
INSERT INTO CONTAINS VALUES('INDIRA GANDHI',124);
SELECT * FROM CONTAINS;

CREATE TABLE FLIGHT
(FLIGHT_NO INT NOT NULL PRIMARY KEY,
STATUS VARCHAR(20),
SOURCE VARCHAR(20) NOT NULL,
DESTINATION VARCHAR(20) NOT NULL,
D_TIME DATE,
A_TIME DATE,
DURATION INT NOT NULL,
AIRLINE_ID INT,
FOREIGN KEY (AIRLINE_ID) REFERENCES AIRLINE(AIRLINE_ID));
DESC FLIGHT;

INSERT INTO FLIGHT VALUES(12345,'ON TIME','MUMBAI','DELHI', to_date('20-02-2022 4:00 am','dd-mm-yyyy hh:mi am'),to_date('20-02-2022 8:00 am','dd-mm-yyyy hh:mi am'),4,123);
INSERT INTO FLIGHT VALUES(12356,'ON TIME','DELHI', 'MUMBAI', to_date('20-02-2022 10:00 pm','dd-mm-yyyy hh:mi am'),to_date('21-02-2022 4:00 am','dd-mm-yyyy hh:mi am'),6,124);
INSERT INTO FLIGHT VALUES(12389,'ON TIME','DELHI', 'MUMBAI', to_date('24-02-2022 9:15 am','dd-mm-yyyy hh:mi am'),to_date('25-02-2022 12:15 pm','dd-mm-yyyy hh:mi am'),3,124);
SELECT * FROM FLIGHT;

CREATE OR REPLACE PROCEDURE INFO_FLIGHT_AIRLINE(AI NUMBER)
IS
TEMP FLIGHT%ROWTYPE;
BEGIN
SELECT * INTO TEMP FROM FLIGHT WHERE AIRLINE_ID=AI;
DBMS_OUTPUT.PUT_LINE(' AIRLINE ID: '||TEMP.AIRLINE_ID||' FLIGHT_NO: '||TEMP.FLIGHT_NO||' SOURCE: '||TEMP.SOURCE||' DESTINATION: '||TEMP.DESTINATION);
END;
BEGIN
INFO_FLIGHT_AIRLINE(123);
END;

CREATE OR REPLACE PROCEDURE FLIGHTNO_DTIME(SR VARCHAR,DT VARCHAR)
IS
TEMP FLIGHT%ROWTYPE;
BEGIN
SELECT * INTO TEMP FROM FLIGHT WHERE SOURCE=SR AND DESTINATION=DT;
DBMS_OUTPUT.PUT_LINE(' FLIGHT_NO: '||TEMP.FLIGHT_NO||' DEPARTURE DATE: '||TEMP.D_TIME);
END;
BEGIN
FLIGHTNO_DTIME('MUMBAI','DELHI');
END;

CREATE TABLE EMPLOYEE
(E_ID INT PRIMARY KEY,
NAME VARCHAR(20),
DESIGNATION VARCHAR(20),
ADDRESS VARCHAR(20),
SEX VARCHAR(1),
SALARY INT,
AGE INT,
AIRPORT_NAME VARCHAR(20),
FOREIGN KEY (AIRPORT_NAME) REFERENCES AIRPORT(AIRPORT_NAME));
DESC EMPLOYEE;

INSERT INTO EMPLOYEE VALUES(13,'KHUSHBOO','CAPTAIN','MUMBAI','F',40000,19,'SHIVAJI');
INSERT INTO EMPLOYEE VALUES(14,'RAHUL','STEWARD','MUMBAI','M',30000,20,'SHIVAJI');
INSERT INTO EMPLOYEE VALUES(15,'LAXMI','1ST OFFICER','DELHI','F',20000,23,'INDIRA GANDHI');
INSERT INTO EMPLOYEE VALUES(16,'SARU','AIR HOSTESS','DELHI','F',22000,19,'INDIRA GANDHI');
SELECT * FROM EMPLOYEE;

--DISPLAYING EMPLOYEE WORKING ON A PARTICULAR AIRPORT
SELECT E_ID,NAME,DESIGNATION,SEX FROM EMPLOYEE WHERE AIRPORT_NAME='SHIVAJI';
CREATE TABLE EMP_PHONE_NO
(E_ID INT, PHONE_NO VARCHAR(11),
FOREIGN KEY (E_ID) REFERENCES EMPLOYEE(E_ID));
DESC EMP_PHONE_NO;

INSERT INTO EMP_PHONE_NO VALUES(13,'8595530155');
INSERT INTO EMP_PHONE_NO VALUES(14,'9910712565');
INSERT INTO EMP_PHONE_NO VALUES(16,'9810317494');
SELECT * FROM EMP_PHONE_NO;

CREATE TABLE PASSENGER
(PASSPORT_NO VARCHAR(20) NOT NULL PRIMARY KEY,
NAME VARCHAR(20) NOT NULL,
ADDRESS VARCHAR(20),
SEX VARCHAR(1),
AGE INT,
FLIGHT_NO INT,
TICKET_NO VARCHAR(20),
FOREIGN KEY (FLIGHT_NO) REFERENCES FLIGHT(FLIGHT_NO));
DESC PASSENGER;

INSERT INTO PASSENGER VALUES(123,'VANSH','BANGALORE','M',5,'12356',786);
INSERT INTO PASSENGER VALUES(456,'TINA','JAMMU','F',19,'12345',777);
INSERT INTO PASSENGER VALUES(789,'NEHA','WEST BENGAL','F',64,'12345',786);
SELECT * FROM PASSENGER;

CREATE TABLE SERVES
(E_ID INT,
PASSPORT_NO VARCHAR(20),
FOREIGN KEY (E_ID) REFERENCES EMPLOYEE(E_ID),
FOREIGN KEY (PASSPORT_NO) REFERENCES PASSENGER(PASSPORT_NO));
DESC SERVES;

INSERT INTO SERVES VALUES(13,123);
INSERT INTO SERVES VALUES(16,456);
INSERT INTO SERVES VALUES(14,789);
SELECT * FROM PASSENGER;

CREATE TABLE PASSENGER_PHONE_NO
(PASSPORT_NO VARCHAR(20) PRIMARY KEY,
PHONE_NO VARCHAR(11),
FOREIGN KEY (PASSPORT_NO) REFERENCES PASSENGER(PASSPORT_NO));
DESC PASSENGER_PHONE_NO;

INSERT INTO PASSENGER_PHONE_NO VALUES(123,'8995701521');
INSERT INTO PASSENGER_PHONE_NO VALUES(456,'7015235821');
INSERT INTO PASSENGER_PHONE_NO VALUES(789,'9751721389');
select * FROM PASSENGER_PHONE_NO;

CREATE TABLE TICKET
(TICKET_NO VARCHAR(20) NOT NULL PRIMARY KEY,
AIRLINE_ID INT NOT NULL,
PRICE INT NOT NULL,
SEAT_NO VARCHAR(20),
CLASS VARCHAR(20),
D_TIME DATE,
A_TIME DATE,
DURATION INT,
DESTINATION VARCHAR(20),
SOURCE VARCHAR(20),
PASSPORT_NO VARCHAR(20),
PASSENGER_NAME VARCHAR(20),
DATE_OF_BOOKING DATE,
FOREIGN KEY (AIRLINE_ID) REFERENCES AIRLINE(AIRLINE_ID),
FOREIGN KEY (PASSPORT_NO) REFERENCES PASSENGER(PASSPORT_NO));
DESC TICKET;

INSERT INTO TICKET VALUES(786,123,6000,'A-2','FIRST',to_date('20-02-2022 4:00 am','dd-mm-yyyy hh:mi am'),to_date('20-02-2022 8:00 am','dd-mm-yyyy hh:mi am'),4,'BANGALORE','DELHI',123,'VANSH',to_date('20-02-2022','dd-mm-yyyy'));
INSERT INTO TICKET VALUES(777,124,4000,'H-42','SECOND',to_date('24-02-2022 9:15 am','dd-mm-yyyy hh:mi am'),to_date('25-02-2022 12:15 am','dd-mm-yyyy hh:mi am'),3,'GOA','CHANDIGARH',456,'NEHA',to_date('24-02-2022','dd-mm-yyyy'));
SELECT * FROM TICKET;

--DISPLAYING DEPARTURE DATE AND PRICE OF A TICKET FOR A PARTICULAR SOURCE AND DESTINATION
SELECT D_TIME,PRICE FROM TICKET WHERE SOURCE='DELHI' AND DESTINATION='BANGALORE';
CREATE TABLE DELAYED_FLIGHTS
(FLIGHT_NO VARCHAR(20),
DESTINATION VARCHAR(20),
SOURCE VARCHAR(20),
AIRLINE_ID VARCHAR(20),
REPORT_TIME DATE);
DESC DELAYED_FLIGHTS;
CREATE OR REPLACE TRIGGER DELAYEDFLIGHTS
AFTER INSERT ON FLIGHT
FOR EACH ROW
DECLARE
BEGIN
IF UPDATING('STATUS') THEN
INSERT INTO DELAYED_FLIGHTS(FLIGHT_NO,SOURCE,DESTINATION,AIRLINE_ID,REPORT_TIME) VALUES (:NEW.FLIGHT_NO,:NEW.SOURCE,:NEW.DESTINATION,:NEW.AIRLINE_ID,SYSDATE);
END IF;
END;

CREATE OR REPLACE TRIGGER UPDATEDSAL
AFTER INSERT OR UPDATE OF SALARY ON EMPLOYEE
FOR EACH ROW
DECLARE
JOBTYPE EMPLOYEE.DESIGNATION%TYPE;
BEGIN
CASE
WHEN (JOBTYPE='STEWARD') THEN
UPDATE EMPLOYEE SET SALARY=SALARY+SALARY*.10;
WHEN (JOBTYPE='1ST OFFICER') THEN
UPDATE EMPLOYEE SET SALARY=SALARY+SALARY*.50;
WHEN (JOBTYPE='CAPTAIN') THEN
UPDATE EMPLOYEE SET SALARY=SALARY+SALARY*.30;
WHEN (JOBTYPE= 'AIR HOSTESS') THEN
UPDATE EMPLOYEE SET SALARY=SALARY+SALARY*.10;
END CASE;
END;

CREATE TABLE TICKET_PRICE_HISTORY
(DATE_OF_BOOKING DATE NOT NULL,
SOURCE VARCHAR(20) NOT NULL,
DESTINATION VARCHAR(20) NOT NULL,
CLASS VARCHAR(20) NOT NULL,
PRICE INT,
PRIMARY KEY(DATE_OF_BOOKING, SOURCE, DESTINATION, CLASS));
DESC TICKET_PRICE_HISTORY;
CREATE OR REPLACE TRIGGER TICKET_PRICE_HISTORY
BEFORE UPDATE OF PRICE
ON TICKET
FOR EACH ROW
BEGIN
INSERT INTO TICKET_PRICE_HISTORY VALUES(:OLD.DATE_OF_BOOKING, :OLD.SOURCE, :OLD.DESTINATION, :OLD.CLASS, :OLD.PRICE);
END;

DECLARE
CURSOR F_COUNT IS SELECT * FROM FLIGHT;
TEMP F_COUNT%ROWTYPE;
BEGIN
OPEN F_COUNT;
LOOP
FETCH F_COUNT INTO TEMP;
EXIT WHEN F_COUNT%NOTFOUND;
DBMS_OUTPUT.PUT_LINE('Flight No: ' || TEMP.FLIGHT_NO);
END LOOP;
CLOSE F_COUNT;
END;

CREATE OR REPLACE TRIGGER AFTER_INSERT_TR
AFTER INSERT ON AIRPORT
FOR EACH ROW
BEGIN
DBMS_OUTPUT.PUT_LINE('INSERT SUCCESSFULLY');
END;
CREATE OR REPLACE TRIGGER BEFORE_INSERT_TR
BEFORE INSERT ON AIRPORT
FOR EACH ROW
BEGIN
:NEW.AIRPORT_NAME := TRIM(:NEW.AIRPORT_NAME);
:NEW.CITY := TRIM(:NEW.CITY);
:NEW.STATE := TRIM(:NEW.STATE);
END;

--SELECT NAME AND SALARY FROM EMPLOYEE HAVING PHONE NUMBER:
SELECT E.NAME, E.SALARY FROM EMPLOYEE E WHERE E_ID IN
(SELECT EP.E_ID FROM EMP_PHONE_NO EP WHERE EP.E_ID=E.E_ID);

--SELECT NAME AND SALARY AND ID IN WHICH E_ID IS BETWEEN 1 TO 5 having phone number:
SELECT E.E_ID, E.NAME, E.SALARY FROM EMPLOYEE E WHERE E.E_ID IN
(SELECT EP.E_ID FROM EMP_PHONE_NO EP WHERE EP.E_ID IN (1,5));

--SELECT NAME BASED ON AIRPORT_NAME WHERE CITY IS MUMBAI:
SELECT E.NAME, E.E_ID FROM EMPLOYEE E WHERE E.AIRPORT_NAME IN
(SELECT A.AIRPORT_NAME FROM AIRPORT A WHERE A.CITY='MUMBAI');

--SELECT NAME AND SEX WHERE EMPLOYEE ID IS GREATER THAN 3 AND HAVING PHONE NUMBER
SELECT E.E_ID, E.NAME, E.SEX FROM EMPLOYEE E WHERE E.E_ID IN
(SELECT EP.E_ID FROM EMP_PHONE_NO EP WHERE E.E_ID = EP.E_ID AND EP.E_ID>=3);

--SELECT EMPLOYEE NAME, ID HAVING MULTIPLE PHONE NUMBERS:
SELECT E.NAME, E.E_ID FROM EMPLOYEE E WHERE E.E_ID IN
(SELECT EP.E_ID FROM EMP_PHONE_NO EP GROUP BY EP.E_ID HAVING COUNT(*) > 1);

--SELECT NAME, ADDRESS, AGE, SEX WHERE CITY IS Mumbai or Delhi
SELECT E.NAME, E.ADDRESS, E.AGE, E.SEX FROM EMPLOYEE E WHERE E.AIRPORT_NAME IN
(SELECT A.AIRPORT_NAME FROM AIRPORT A WHERE A.CITY IN ('MUMBAI', 'DELHI'));

--SELECT NAME, PASSPORT NUMBER OF PASSENGERS WHERE AIRLINE_NAME IS Mumbai Airlines
SELECT P.NAME, P.PASSPORT_NO FROM PASSENGER P WHERE P.TICKET_NO IN
(SELECT T.TICKET_NO FROM TICKET T WHERE T.AIRLINE_NAME = 'MLINES');

--SELECT NAME, PASSPORT NUMBER OF PASSENGERS WHERE CLASS IS First Class
SELECT P.NAME, P.PASSPORT_NO FROM PASSENGER P WHERE P.TICKET_NO IN
(SELECT T.TICKET_NO FROM TICKET T WHERE T.CLASS = 'FIRST CLASS');

--SELECT PASSENGER NAME HAVING MULTIPLE PHONE NUMBERS:
SELECT P.NAME FROM PASSENGER P WHERE P.PASSPORT_NO IN
(SELECT PPN.PASSPORT_NO FROM PASSENGER_PHONE_NO PPN GROUP BY PPN.PASSPORT_NO HAVING COUNT(*)>1);

--SELECT PASSENGER NAME, SEX, TICKET NUMBER HAVING FLIGHT DESTINATION AS Delhi
SELECT P.NAME, P.SEX, P.TICKET_NO FROM PASSENGER P WHERE P.FLIGHT_NO IN
(SELECT F.FLIGHT_NO FROM FLIGHT F WHERE F.DESTINATION = 'DELHI');

--SELECT EMPLOYEE ID, PHONE NUMBER, AND AIRPORT NAME WHERE CITY IS Delhi
SELECT E.E_ID,P.PHONE_NO,A.AIRPORT_NAME FROM EMPLOYEE E,EMP_PHONE_NO P,AIRPORT A
WHERE E.E_ID=P.E_ID AND E.AIRPORT_NAME = A.AIRPORT_NAME AND A.CITY IN ('DELHI');

--Select children (with age 10 or less) Senior Citizens (with age 60 or greater) Passport Number, Name, Age, Flight Number, Ticket Number, travelling from Delhi.
--Method 1
SELECT P.PASSPORT_NO, P.NAME, P.AGE, P.FLIGHT_NO, T.TICKET_NO FROM PASSENGER P, TICKET T
WHERE T.SOURCE IN ('DELHI') AND (P.AGE >= 60 OR P.AGE <= 10);

--Method 2
SELECT P.PASSPORT_NO, P.NAME, P.AGE, P.FLIGHT_NO, T.TICKET_NO from PASSENGER P, TICKET T
WHERE (P.AGE >= 60 OR P.AGE <= 10) AND T.SOURCE IN (SELECT T.SOURCE FROM TICKET T WHERE T.SOURCE = 'DELHI');

--Select Senior Citizens (with age 60 or greater) - Passport Number, Name, Age, Flight Number, Ticket Number, Seat number travelling to Delhi, with the SpiceJet Airline
SELECT P.PASSPORT_NO, P.NAME, P.AGE, P.FLIGHT_NO, T.TICKET_NO, T.SEAT_NO FROM PASSENGER P, TICKET T
WHERE P.PASSPORT_NO=T.PASSPORT_NO AND T.DESTINATION='DELHI' AND P.AGE >= 60 AND T.AIRLINE_NAME = 'MLINES';
